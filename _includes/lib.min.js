/*------------------------------------*\
  #MENUS
\*------------------------------------*/

var timer = [0,1];

var dropdownMenu = ".nav-dropdown";
var dropdownButton = ".nav-dropdown > a";
var dropdownList = ".nav-dropdown > ul";
var navButton = ".main-nav-btn";
var navList = ".main-nav"
var navIcon = "#main-nav-btn__icon"

var hasTouch = false;

window.addEventListener("touchstart", function onFirstTouch() {
  $(":focus").css("outline","none");
	hasTouch = true;
  console.log("Touch!");
  window.removeEventListener("touchstart", onFirstTouch, false);
}, false); 


if (hasTouch == true) { // If touch, for each dropdown "a" link wait for touchstart
	$(dropdownButton).each(function(i, el){
		el.addEventListener("touchstart", function(event){
				if ($(dropdownButton).attr("aria-expanded") == "true") {
					closeMenu("dropdown");
				} else {
					openMenu("dropdown");
				};
		});
	});
};

// If no touch, use hover and click
$(dropdownMenu).each(function(i, el){
  console.log(i)
  el.addEventListener("mouseover", 
    function dropdownMouseover(event) {
      openMenu("dropdown",$(this),i);
      $(dropdownMenu).attr("hover", "true")
    }
  );
  el.addEventListener("mouseout", 
    function dropdownMouseout(event) {
      closeMenu("dropdownTimeout",$(this),i);
    }
  );
	$(dropdownButton)[0].addEventListener("click", dropdownClick);
	htmlClose("click", dropdownButton, "dropdown", dropdownMenu);
});



	function dropdownMouseout(event) {
		closeMenu("dropdownTimeout",$(this));
	};

	function dropdownClick(event) {
		if ($(dropdownButton).attr("aria-expanded") == "true" && $(dropdownMenu).attr("hover") != "true") {
			closeMenu("dropdown");
		} else {
			openMenu("dropdown");
			$(dropdownMenu).attr("hover", "false");
		};
		event.preventDefault();
		event.stopPropagation();
	};


if (hasTouch == true) { // If on mobile, use touch
	el.addEventListener("touchstart", function(event){
		if ($(navButton).attr("aria-expanded") == "true") {
			closeMenu("nav");
		} else {
			openMenu("nav");
		};
			});
};

$(navButton).each(function(i, el){
	el.addEventListener("click", navClick);
	htmlClose("click", navButton, "nav", navButton);
  $(navList)[0].addEventListener("click", function(event){
		event.stopPropagation();
	});
});


function navClick(event){
	if ($(navButton).attr("aria-expanded") == "true") {
		closeMenu("nav");
	} else {
		openMenu("nav");
	};
}


function htmlClose(clickType, ariaObj, closeObj, protectObj) {
	$("html")[0].addEventListener(clickType, function(event){
		if ($(ariaObj).attr("aria-expanded") == "true") { 
			closeMenu(closeObj);
		};
	});

	// When using menu, do not propagate interaction to HTML
	$(protectObj)[0].addEventListener(clickType, function(event){
		event.stopPropagation();
	});
};



function openMenu(type,thisObj, i) {
  console.log(i)
	if (type == "nav") {
		$(navButton).attr("aria-expanded", "true");
		$(navList).slideDown("fast");
		$(navButton).addClass("open");
		$(navIcon).attr("class", "open");
	} else if (type == "dropdown") {
    $(thisObj).children("ul").slideDown("fast"); // Hard open
		$(thisObj).children("a").attr("aria-expanded", "true");
    clearTimeout(timer[i]);
	};
};

function closeMenu(type,thisObj, i) {
	if (type == "nav") {
		$(navList).slideUp("fast");
		$(navButton).attr("aria-expanded", "false");
		$(navButton).removeClass("open");
		$(navIcon).attr("class", "");
	} else if (type == "dropdown") {
		$(thisObj).children("ul").slideUp("fast"); // Hard close
		$(thisObj).children("a").attr("aria-expanded", "false");
	} else if (type == "dropdownTimeout") {
    timer[i] = setTimeout(function(event){
      $(thisObj).children("ul").slideUp("fast");
      $(thisObj).children("a").attr("aria-expanded", "false");
    }, 500);
	}
};




// $("#slideshow > img:gt(0)").hide();

// setInterval(function() { 
//   $('#slideshow > img:first')
//     .fadeOut(1000)
//     .next()
//     .fadeIn(1000)
//     .end()
//     .appendTo('#slideshow');
// },  3000);

var slides = document.querySelectorAll('#slideshow .slide');
var currentSlide = 0;
var slideInterval = setInterval(nextSlide,10000);

function nextSlide() {
    slides[currentSlide].className = 'slide';
    currentSlide = (currentSlide+1)%slides.length;
    slides[currentSlide].className = 'slide show';
}
		



// var prev = 0;

// $(window).on("scroll", function() {
//   var n = $(window).scrollTop();
//   n > 120 && ($(".top-bar").toggleClass("scroll", n > prev), prev = n)
// }), "yes" == $.cookie("highcontrast") && ($(".js-high-contrast-on").addClass("active"), $(".js-high-contrast-off").removeClass("active"), $(".mtn-scene").addClass("mtn-scene--hidden"), $(".mtn-scene--fallback").addClass("mtn-scene--fallback--show"), $(".green").each(function(n, o) {
//   $(this).addClass("high-contrast")
// }), $(".mtn-scene__controls").addClass("hidden")), $(".js-high-contrast-off").click(function() {
//   $(this).hasClass("active") || ($(".js-high-contrast-off").addClass("active"), $(".js-high-contrast-on").removeClass("active"), $(".mtn-scene").removeClass("mtn-scene--hidden"), $(".mtn-scene--fallback").removeClass("mtn-scene--fallback--show"), $(".green").each(function(n, o) {
//     $(this).removeClass("high-contrast")
//   }), $(".mtn-scene__controls").removeClass("hidden"), "yes" == $.cookie("highcontrast") && $.cookie("highcontrast", null, {
//     path: "/"
//   }))
// }), $(".js-high-contrast-on").click(function() {
//   $(this).hasClass("active") || ("undefined" == $.cookie("highcontrast") || "no" == $.cookie("highcontrast") ? ($.cookie("highcontrast", "yes", {
//     expires: 7,
//     path: "/"
//   }), $(".js-high-contrast-on").addClass("active"), $(".js-high-contrast-off").removeClass("active"), $(".mtn-scene").addClass("mtn-scene--hidden"), $(".mtn-scene--fallback").addClass("mtn-scene--fallback--show"), $(".green").each(function(n, o) {
//     $(this).addClass("high-contrast")
//   }), $(".mtn-scene__controls").removeClass("hidden")) : ($.cookie("highcontrast", "yes", {
//     expires: 7,
//     path: "/"
//   }), $(".js-high-contrast-on").addClass("active"), $(".js-high-contrast-off").removeClass("active"), $(".mtn-scene").addClass("mtn-scene--hidden"), $(".mtn-scene--fallback").addClass("mtn-scene--fallback--show"), $(".green").each(function(n, o) {
//     $(this).addClass("high-contrast")
//   }), $(".mtn-scene__controls").addClass("hidden")))
// }), $(".modal-image").on("click", function() {
//   $("#modal").fadeIn("fast"), $(".modal--content")[0].src = "{{ site.baseurl }}{{ page.image-original}}"
// }), $(".modal--close").on("click", function() {
//   $(".modal").fadeOut("fast")
// });